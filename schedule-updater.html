<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ES Transportation — Schedule Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --blue: #1565C0;
  --blue-light: #1E88E5;
  --blue-pale: #E3F2FD;
  --blue-dark: #0D2137;
  --blue-med: #90CAF9;
  --green: #2e7d32;
  --green-bg: #e8f5e9;
  --red: #c62828;
  --red-bg: #ffebee;
  --orange: #e65100;
  --orange-bg: #fff3e0;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Montserrat', sans-serif;
  background: linear-gradient(135deg, #0D2137 0%, #1565C0 100%);
  min-height: 100vh;
  padding: 24px 16px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 16px;
}

/* ── Cards ── */
.card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.35);
  overflow: hidden;
  flex: 1;
  max-width: 480px;
}
.card-header {
  background: linear-gradient(135deg, var(--blue-dark), var(--blue));
  padding: 18px 22px;
  color: white;
}
.card-header h2 { font-size: 15px; font-weight: 800; }
.card-header p  { font-size: 11px; opacity: 0.7; margin-top: 3px; }
.card-body { padding: 20px 22px; }

/* ── Form ── */
.form-row {
  display: grid;
  grid-template-columns: 1.2fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 10px;
}
.field { display: flex; flex-direction: column; gap: 5px; }
.field label { font-size: 10px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
.field input, .field select {
  border: 1.5px solid #d0daea;
  border-radius: 8px;
  padding: 9px 10px;
  font-family: 'Montserrat', sans-serif;
  font-size: 12px;
  font-weight: 600;
  color: #222;
  background: white;
  outline: none;
  transition: border-color 0.15s;
}
.field input:focus, .field select:focus { border-color: var(--blue); }

.btn-row { display: flex; gap: 8px; margin-top: 4px; }
.add-btn {
  flex: 1;
  background: var(--blue);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 11px;
  font-family: 'Montserrat', sans-serif;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
}
.add-btn:hover { background: var(--blue-light); transform: translateY(-1px); }

.off-btn {
  background: var(--red-bg);
  color: var(--red);
  border: 1.5px solid #ef9a9a;
  border-radius: 8px;
  padding: 11px 16px;
  font-family: 'Montserrat', sans-serif;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.15s;
  white-space: nowrap;
}
.off-btn:hover { background: #ffcdd2; }

/* ── Error ── */
.error-msg {
  background: var(--red-bg);
  border: 1px solid #ef9a9a;
  border-radius: 8px;
  padding: 9px 12px;
  font-size: 11px;
  font-weight: 700;
  color: var(--red);
  margin-bottom: 12px;
  display: none;
}

/* ── Booked Rides List ── */
.divider { height: 1px; background: #eef2f7; margin: 18px 0; }
.section-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: #aaa; margin-bottom: 10px; }

.rides-list { display: flex; flex-direction: column; gap: 6px; min-height: 32px; }
.no-rides { font-size: 12px; color: #ccc; font-weight: 600; text-align: center; padding: 10px 0; }

.date-group { border-radius: 10px; overflow: hidden; border: 1px solid #e8eef5; }
.date-group-hdr {
  background: var(--blue-pale);
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 12px;
  font-weight: 800;
  color: var(--blue-dark);
}
.date-group-hdr .day-sub { font-size: 10px; font-weight: 600; color: var(--blue); margin-left: 6px; }
.clear-btn { background: none; border: none; color: var(--red); font-size: 10px; font-weight: 700; cursor: pointer; font-family: 'Montserrat', sans-serif; }

.ride-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 12px; background: white;
  border-top: 1px solid #f0f4f8;
  font-size: 12px; font-weight: 600; color: #444;
}
.ride-row .rm { background: none; border: none; color: #ddd; font-size: 15px; cursor: pointer; transition: color 0.15s; }
.ride-row .rm:hover { color: var(--red); }

.off-row {
  background: var(--red-bg);
  padding: 8px 12px;
  font-size: 11px;
  font-weight: 700;
  color: var(--red);
  border-top: 1px solid #ffcdd2;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.off-row .rm { background: none; border: none; color: var(--red); font-size: 14px; cursor: pointer; opacity: 0.6; }
.off-row .rm:hover { opacity: 1; }

/* ── Windows preview ── */
.windows-row {
  padding: 7px 12px 8px;
  background: #fafcff;
  border-top: 1px solid #eef2f7;
  font-size: 11px;
  font-weight: 600;
}
.windows-row.has-windows { color: var(--green); }
.windows-row.no-windows  { color: var(--red); }

/* ── Download ── */
.download-btn {
  width: 100%;
  background: var(--green);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 13px;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  margin-top: 18px;
  transition: background 0.15s, transform 0.1s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.download-btn:hover { background: #1b5e20; transform: translateY(-1px); }

.download-note {
  font-size: 10px;
  color: #aaa;
  font-weight: 600;
  text-align: center;
  margin-top: 8px;
}

/* ── Calendar preview (right side) ── */
.cal-nav {
  display: flex; align-items: center;
  justify-content: space-between; margin-bottom: 12px;
}
.cal-nav-btn {
  background: var(--blue-pale); border: none; border-radius: 6px;
  width: 28px; height: 28px; font-size: 14px; cursor: pointer;
  color: var(--blue); font-weight: 700; transition: background 0.15s;
}
.cal-nav-btn:hover { background: var(--blue-med); }
.cal-month-lbl { font-size: 14px; font-weight: 800; color: var(--blue-dark); }
.cal-days-row { display: grid; grid-template-columns: repeat(7,1fr); margin-bottom: 4px; }
.cal-day-lbl { text-align: center; font-size: 9px; font-weight: 700; color: #bbb; text-transform: uppercase; padding: 2px 0; }
.cal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; }
.cc {
  aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
  border-radius: 7px; font-size: 11px; font-weight: 700;
  cursor: default; transition: transform 0.1s;
}
.cc.empty   { background: transparent; }
.cc.past    { background: #f5f5f5; color: #ddd; }
.cc.off     { background: var(--red-bg); color: var(--red); }
.cc.open    { background: var(--green-bg); color: var(--green); cursor: pointer; }
.cc.open:hover { transform: scale(1.1); }
.cc.today   { outline: 2px solid var(--blue); outline-offset: -2px; }
.cc.sel     { background: var(--blue-pale) !important; color: var(--blue) !important; outline: 2px solid var(--blue); outline-offset: -2px; }

.cal-legend {
  display: flex; gap: 10px; flex-wrap: wrap;
  justify-content: center; padding: 10px 0 8px;
}
.leg { display: flex; align-items: center; gap: 4px; font-size: 10px; font-weight: 600; color: #666; }
.leg-dot { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }
.ld-o { background: var(--green-bg); border: 1px solid #a5d6a7; }
.ld-x { background: var(--red-bg); border: 1px solid #ef9a9a; }
.ld-t { background: white; border: 2px solid var(--blue); }

.slots-box {
  display: none; background: #f8fbff; border: 1px solid var(--blue-pale);
  border-radius: 8px; padding: 12px; margin-top: 10px;
}
.slots-box.active { display: block; }
.slots-box-lbl { font-size: 11px; font-weight: 800; color: var(--blue); margin-bottom: 8px; }
.slot-item {
  display: flex; align-items: center; gap: 7px;
  background: white; border: 1px solid #c8e6c9; border-radius: 6px;
  padding: 7px 10px; margin-bottom: 5px;
  font-size: 11px; font-weight: 600; color: var(--green);
}
.slot-item:last-child { margin-bottom: 0; }

@media (max-width: 700px) {
  body { flex-direction: column; align-items: center; }
  .card { max-width: 100%; }
  .form-row { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<!-- ══ LEFT: FORM ══ -->
<div class="card">
  <div class="card-header">
    <h2>&#128652; Add Booked Rides</h2>
    <p>Enter rides as they're confirmed — calendar updates live</p>
  </div>
  <div class="card-body">

    <div class="error-msg" id="errorMsg"></div>

    <div class="form-row">
      <div class="field">
        <label>Date</label>
        <input type="date" id="rideDate">
      </div>
      <div class="field">
        <label>Pickup Time</label>
        <input type="time" id="rideStart">
      </div>
      <div class="field">
        <label>Drop-off Time</label>
        <input type="time" id="rideEnd">
      </div>
    </div>

    <div class="btn-row">
      <button class="add-btn" onclick="addRide()">&#43; Add Booked Ride</button>
      <button class="off-btn" onclick="addDayOff()">&#10006; Full Day Off</button>
    </div>

    <div class="divider"></div>

    <div class="section-lbl">&#128652; Booked Rides</div>
    <div class="rides-list" id="ridesList">
      <div class="no-rides" id="noRidesMsg">No rides added yet.</div>
    </div>

    <button class="download-btn" onclick="downloadCalendar()">
      &#11015; Download Updated Calendar
    </button>
    <div class="download-note">Upload the downloaded file to GitHub to update your live site</div>

  </div>
</div>

<!-- ══ RIGHT: CALENDAR PREVIEW ══ -->
<div class="card">
  <div class="card-header">
    <h2>&#128197; Live Preview</h2>
    <p>Tap any date to see available time windows</p>
  </div>
  <div class="card-body">
    <div class="cal-nav">
      <button class="cal-nav-btn" onclick="changeMonth(-1)">&#8592;</button>
      <span class="cal-month-lbl" id="calMonthLbl"></span>
      <button class="cal-nav-btn" onclick="changeMonth(1)">&#8594;</button>
    </div>
    <div class="cal-days-row">
      <div class="cal-day-lbl">Sun</div><div class="cal-day-lbl">Mon</div>
      <div class="cal-day-lbl">Tue</div><div class="cal-day-lbl">Wed</div>
      <div class="cal-day-lbl">Thu</div><div class="cal-day-lbl">Fri</div>
      <div class="cal-day-lbl">Sat</div>
    </div>
    <div class="cal-grid" id="calGrid"></div>
    <div class="cal-legend">
      <div class="leg"><div class="leg-dot ld-o"></div> Available</div>
      <div class="leg"><div class="leg-dot ld-x"></div> Unavailable</div>
      <div class="leg"><div class="leg-dot ld-t"></div> Today</div>
    </div>
    <div class="slots-box" id="slotsBox">
      <div class="slots-box-lbl" id="slotsBoxLbl"></div>
      <div id="slotsBoxList"></div>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════════
//  BASE SCHEDULE
// ══════════════════════════════════════════
const BASE = {
  0: [{s:"16:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  1: [{s:"05:00",e:"11:00"},{s:"14:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  2: [{s:"05:00",e:"11:00"},{s:"14:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  3: [{s:"05:00",e:"11:00"},{s:"14:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  4: [{s:"05:00",e:"11:00"},{s:"14:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  5: [{s:"05:00",e:"11:00"},{s:"14:00",e:"17:00"},{s:"18:00",e:"24:00"}],
  6: [{s:"05:00",e:"11:00"},{s:"14:00",e:"15:00"},{s:"18:00",e:"24:00"}]
};
const MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const DAYS   = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

let rides   = [];
let offDays = {};
let selCell = null;
const today = new Date();
let cY = today.getFullYear(), cM = today.getMonth();

// ── Helpers ──
function toMins(t){ if(t==="24:00")return 1440; const[h,m]=t.split(':').map(Number);return h*60+m; }
function minsTo12(m){ if(m===1440)return"12:00 AM"; const h=Math.floor(m/60),mn=m%60,ap=h>=12?'PM':'AM',h12=h%12||12; return `${h12}:${String(mn).padStart(2,'0')} ${ap}`; }
function toStr(d){ return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0'); }
function formatDate(ds){ const[y,mo,d]=ds.split('-'); return MONTHS[parseInt(mo)-1]+' '+parseInt(d)+', '+y; }

function computeWindows(date, dayRides){
  const dow = new Date(date+'T12:00:00').getDay();
  let wins  = (BASE[dow]||[]).map(w=>({s:toMins(w.s),e:toMins(w.e)}));
  dayRides.forEach(r=>{
    const rs=toMins(r.start),re=toMins(r.end),nw=[];
    wins.forEach(w=>{
      if(re<=w.s||rs>=w.e){ nw.push(w); }
      else { if(rs>w.s)nw.push({s:w.s,e:rs}); if(re<w.e)nw.push({s:re,e:w.e}); }
    });
    wins=nw;
  });
  return wins.filter(w=>(w.e-w.s)>=30).map(w=>({s:minsTo12(w.s),e:minsTo12(w.e)}));
}

function showError(msg){ const el=document.getElementById('errorMsg'); el.textContent=msg; el.style.display='block'; setTimeout(()=>el.style.display='none',3000); }

// ── Add Ride ──
function addRide(){
  const date=document.getElementById('rideDate').value;
  const start=document.getElementById('rideStart').value;
  const end=document.getElementById('rideEnd').value;
  if(!date)  { showError('Please select a date.'); return; }
  if(!start) { showError('Please enter a pickup time.'); return; }
  if(!end)   { showError('Please enter a drop-off time.'); return; }
  if(start>=end){ showError('Drop-off time must be after pickup time.'); return; }
  rides.push({date,start,end});
  rides.sort((a,b)=>a.date.localeCompare(b.date)||a.start.localeCompare(b.start));
  document.getElementById('rideDate').value='';
  document.getElementById('rideStart').value='';
  document.getElementById('rideEnd').value='';
  refresh();
}

// ── Add Day Off ──
function addDayOff(){
  const date=document.getElementById('rideDate').value;
  if(!date){ showError('Please select a date first.'); return; }
  offDays[date]=true;
  document.getElementById('rideDate').value='';
  refresh();
}

// ── Remove ──
function removeRide(i){ rides.splice(i,1); refresh(); }
function removeOff(d){ delete offDays[d]; refresh(); }
function clearDate(d){ rides=rides.filter(r=>r.date!==d); delete offDays[d]; refresh(); }

// ── Render rides list ──
function renderList(){
  const list=document.getElementById('ridesList');
  const byDate={};
  rides.forEach((r,i)=>{ if(!byDate[r.date])byDate[r.date]=[]; byDate[r.date].push({...r,i}); });
  Object.keys(offDays).forEach(d=>{ if(!byDate[d])byDate[d]=[]; });
  const dates=Object.keys(byDate).sort();
  if(dates.length===0){ list.innerHTML='<div class="no-rides">No rides added yet.</div>'; return; }
  list.innerHTML='';
  dates.forEach(date=>{
    const dow=new Date(date+'T12:00:00').getDay();
    const grp=document.createElement('div'); grp.className='date-group';
    // Header
    grp.innerHTML=`<div class="date-group-hdr"><span>${formatDate(date)}<span class="day-sub">${DAYS[dow]}</span></span><button class="clear-btn" onclick="clearDate('${date}')">&#x2715; Clear</button></div>`;
    // Off day row
    if(offDays[date]){
      const row=document.createElement('div'); row.className='off-row';
      row.innerHTML=`&#10006; Full day off <button class="rm" onclick="removeOff('${date}')">&#x2715;</button>`;
      grp.appendChild(row);
    }
    // Ride rows
    byDate[date].forEach(r=>{
      const row=document.createElement('div'); row.className='ride-row';
      row.innerHTML=`<span>&#128652; Booked ${fmt(r.start)} – ${fmt(r.end)}</span><button class="rm" onclick="removeRide(${r.i})">&#x2715;</button>`;
      grp.appendChild(row);
    });
    // Windows preview
    if(!offDays[date]){
      const wins=computeWindows(date,byDate[date]);
      const prev=document.createElement('div');
      if(wins.length===0){ prev.className='windows-row no-windows'; prev.innerHTML='&#10006; No windows left — shown as unavailable'; }
      else { prev.className='windows-row has-windows'; prev.innerHTML='&#10003; Open: '+wins.map(w=>`${w.s}–${w.e}`).join(' · '); }
      grp.appendChild(prev);
    }
    list.appendChild(grp);
  });
}

function fmt(t){ const[h,m]=t.split(':').map(Number),ap=h>=12?'PM':'AM',h12=h%12||12; return `${h12}:${String(m).padStart(2,'0')} ${ap}`; }

// ── Calendar ──
function changeMonth(dir){ cM+=dir; if(cM>11){cM=0;cY++;} if(cM<0){cM=11;cY--;} hideSlotsBox(); renderCal(); }
function hideSlotsBox(){ document.getElementById('slotsBox').classList.remove('active'); if(selCell){selCell.classList.remove('sel');selCell=null;} }

function renderCal(){
  document.getElementById('calMonthLbl').textContent=MONTHS[cM]+' '+cY;
  const grid=document.getElementById('calGrid'); grid.innerHTML='';
  const first=new Date(cY,cM,1).getDay(), days=new Date(cY,cM+1,0).getDate(), tStr=toStr(today);
  for(let i=0;i<first;i++){ const e=document.createElement('div');e.className='cc empty';grid.appendChild(e); }
  for(let d=1;d<=days;d++){
    const ds=toStr(new Date(cY,cM,d));
    const el=document.createElement('div'); el.textContent=d;
    const isPast=ds<tStr, isToday=ds===tStr;
    if(isPast&&!isToday){ el.className='cc past'; }
    else if(offDays[ds]){ el.className='cc off'; }
    else {
      const dr=rides.filter(r=>r.date===ds);
      const wins=computeWindows(ds,dr);
      if(wins.length===0) { el.className='cc off'; }
      else                { el.className='cc open'; el.onclick=()=>showSlotsBox(ds,wins,el); }
    }
    if(isToday) el.classList.add('today');
    grid.appendChild(el);
  }
}

function showSlotsBox(ds,wins,el){
  if(selCell)selCell.classList.remove('sel');
  selCell=el; el.classList.add('sel');
  const dow=new Date(ds+'T12:00:00').getDay();
  document.getElementById('slotsBoxLbl').textContent=DAYS[dow]+', '+formatDate(ds);
  const list=document.getElementById('slotsBoxList'); list.innerHTML='';
  wins.forEach(w=>{ const r=document.createElement('div');r.className='slot-item';r.innerHTML=`&#9200; ${w.s} – ${w.e}`;list.appendChild(r); });
  document.getElementById('slotsBox').classList.add('active');
}

// ── Refresh everything ──
function refresh(){ renderList(); renderCal(); hideSlotsBox(); }

// ══════════════════════════════════════════
//  DOWNLOAD CALENDAR
// ══════════════════════════════════════════
function buildOverrides(){
  const byDate={};
  rides.forEach(r=>{ if(!byDate[r.date])byDate[r.date]=[]; byDate[r.date].push(r); });
  Object.keys(offDays).forEach(d=>{ if(!byDate[d])byDate[d]=[]; });
  const lines=Object.keys(byDate).sort().map(date=>{
    if(offDays[date]) return `  "${date}": ["OFF"]`;
    const wins=computeWindows(date,byDate[date]);
    if(wins.length===0) return `  "${date}": ["OFF"]`;
    return `  "${date}": [${wins.map(w=>`"${w.s} \u2013 ${w.e}"`).join(', ')}]`;
  });
  return lines.length>0 ? `const DATE_OVERRIDES = {\n${lines.join(',\n')}\n};` : `const DATE_OVERRIDES = {};`;
}

function downloadCalendar(){
  const overrides = buildOverrides();
  const html = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Availability \u2014 ES Transportation</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--blue:#1565C0;--blue-light:#1E88E5;--blue-pale:#E3F2FD;--blue-dark:#0D2137;--green:#2e7d32;--green-bg:#e8f5e9;--red:#c62828;--red-bg:#ffebee;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Montserrat',sans-serif;background:#f0f4f8;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:0 0 40px;}
.top-bar{width:100%;background:linear-gradient(135deg,var(--blue-dark),var(--blue));padding:16px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;}
.top-bar h1{font-size:16px;font-weight:800;color:white;}
.top-bar p{font-size:11px;color:rgba(255,255,255,0.7);margin-top:2px;}
.back-btn{background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:white;border-radius:20px;padding:7px 16px;font-family:'Montserrat',sans-serif;font-size:12px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:6px;}
.back-btn:hover{background:rgba(255,255,255,0.25);}
.main{display:flex;gap:20px;width:100%;max-width:860px;padding:24px 16px 0;align-items:flex-start;}
.cal-card{background:white;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.10);flex:1;min-width:0;overflow:hidden;}
.cal-nav{display:flex;align-items:center;justify-content:space-between;padding:18px 22px 14px;border-bottom:1px solid #f0f0f0;}
.cal-nav-btn{background:var(--blue-pale);border:none;border-radius:8px;width:36px;height:36px;font-size:18px;cursor:pointer;color:var(--blue);font-weight:700;}
.cal-nav-btn:hover{background:#90CAF9;}
.cal-month-label{font-size:18px;font-weight:800;color:var(--blue-dark);}
.cal-days-header{display:grid;grid-template-columns:repeat(7,1fr);padding:12px 16px 6px;}
.cal-day-lbl{text-align:center;font-size:11px;font-weight:700;color:#bbb;text-transform:uppercase;letter-spacing:0.5px;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;padding:6px 16px 18px;}
.cal-cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:10px;font-size:15px;font-weight:700;cursor:default;transition:transform 0.1s,box-shadow 0.1s;user-select:none;}
.cal-cell.empty{background:transparent;}
.cal-cell.past{background:#f5f5f5;color:#ccc;}
.cal-cell.off{background:var(--red-bg);color:var(--red);}
.cal-cell.open{background:var(--green-bg);color:var(--green);cursor:pointer;}
.cal-cell.open:hover{transform:scale(1.08);box-shadow:0 4px 12px rgba(0,0,0,0.12);}
.cal-cell.today{outline:2px solid var(--blue);outline-offset:-2px;}
.cal-cell.selected{background:var(--blue)!important;color:white!important;outline:none;box-shadow:0 4px 14px rgba(21,101,192,0.4);}
.cal-legend{display:flex;gap:16px;justify-content:center;padding:12px 16px 16px;flex-wrap:wrap;border-top:1px solid #f0f0f0;}
.legend-item{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:600;color:#666;}
.legend-dot{width:13px;height:13px;border-radius:4px;flex-shrink:0;}
.ld-open{background:var(--green-bg);border:1px solid #a5d6a7;}
.ld-off{background:var(--red-bg);border:1px solid #ef9a9a;}
.ld-today{background:white;border:2px solid var(--blue);}
.right-panel{width:240px;flex-shrink:0;display:flex;flex-direction:column;gap:14px;}
.tap-hint{background:white;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.08);padding:20px 16px;text-align:center;font-size:12px;font-weight:600;color:#aaa;line-height:1.6;}
.tap-hint .hint-icon{font-size:28px;display:block;margin-bottom:8px;}
.slots-box{background:white;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.10);overflow:hidden;display:none;}
.slots-box.active{display:block;}
.slots-box-header{background:var(--blue);padding:13px 16px;color:white;}
.slots-box-header .date-lbl{font-size:13px;font-weight:800;}
.slots-box-header .day-lbl{font-size:10px;opacity:0.75;margin-top:2px;}
.slots-body{padding:12px 14px 14px;}
.slot-row{display:flex;align-items:center;gap:8px;background:var(--green-bg);border:1px solid #c8e6c9;border-radius:8px;padding:9px 12px;margin-bottom:7px;font-size:12px;font-weight:700;color:var(--green);}
.slot-row:last-child{margin-bottom:0;}
.contact-card{background:linear-gradient(135deg,var(--blue-dark),var(--blue));border-radius:16px;padding:18px 16px;color:white;text-align:center;box-shadow:0 4px 20px rgba(21,101,192,0.3);}
.contact-card p{font-size:11px;opacity:0.8;margin-bottom:10px;line-height:1.5;}
.contact-card a{display:block;background:white;color:var(--blue);border-radius:8px;padding:11px;font-size:14px;font-weight:800;text-decoration:none;}
@media(max-width:640px){.main{flex-direction:column;padding:14px 12px 0;gap:14px;}.right-panel{width:100%;}.cal-cell{font-size:13px;}.cal-grid{gap:4px;padding:4px 12px 14px;}}
</style>
</head>
<body>
<div class="top-bar">
  <div><h1>&#128197; Check Availability</h1><p>ES Transportation &amp; Courier Services</p></div>
  <a class="back-btn" href="https://estransport.github.io/estransportcourier/personaldriver.html">&#8592; Back to Booking</a>
</div>
<div class="main">
  <div class="cal-card">
    <div class="cal-nav">
      <button class="cal-nav-btn" onclick="changeMonth(-1)">&#8592;</button>
      <span class="cal-month-label" id="calMonthLabel"></span>
      <button class="cal-nav-btn" onclick="changeMonth(1)">&#8594;</button>
    </div>
    <div class="cal-days-header">
      <div class="cal-day-lbl">Sun</div><div class="cal-day-lbl">Mon</div><div class="cal-day-lbl">Tue</div><div class="cal-day-lbl">Wed</div><div class="cal-day-lbl">Thu</div><div class="cal-day-lbl">Fri</div><div class="cal-day-lbl">Sat</div>
    </div>
    <div class="cal-grid" id="calGrid"></div>
    <div class="cal-legend">
      <div class="legend-item"><div class="legend-dot ld-open"></div>Available \u2014 tap for times</div>
      <div class="legend-item"><div class="legend-dot ld-off"></div>Unavailable</div>
      <div class="legend-item"><div class="legend-dot ld-today"></div>Today</div>
    </div>
  </div>
  <div class="right-panel">
    <div class="tap-hint" id="tapHint"><span class="hint-icon">&#128197;</span>Tap any <strong style="color:var(--green)">green date</strong> to see available time windows</div>
    <div class="slots-box" id="slotsBox">
      <div class="slots-box-header">
        <div class="date-lbl" id="slotsDateLbl"></div>
        <div class="day-lbl" id="slotsDayLbl"></div>
      </div>
      <div class="slots-body" id="slotsBody"></div>
    </div>
    <div class="contact-card">
      <p>Ready to book? Call or text us to confirm your ride.</p>
      <a href="tel:8329913705">&#128222; 832-991-3705</a>
    </div>
  </div>
</div>
<script>
const DEFAULT_SCHEDULE={0:["4:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],1:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],2:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],3:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],4:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],5:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 5:00 PM","6:00 PM \u2013 12:00 AM"],6:["5:00 AM \u2013 11:00 AM","2:00 PM \u2013 3:00 PM","6:00 PM \u2013 12:00 AM"]};
${overrides}
const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
const DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const today=new Date();let cY=today.getFullYear(),cM=today.getMonth(),selCell=null;
function toStr(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');}
function formatDate(ds){const[y,mo,d]=ds.split('-');return MONTHS[parseInt(mo)-1]+' '+parseInt(d)+', '+y;}
function getSlotsForDate(ds){if(DATE_OVERRIDES[ds]!==undefined)return DATE_OVERRIDES[ds];const dow=new Date(ds+'T12:00:00').getDay();return DEFAULT_SCHEDULE[dow]||["OFF"];}
function changeMonth(dir){cM+=dir;if(cM>11){cM=0;cY++;}if(cM<0){cM=11;cY--;}hideSlots();renderCal();}
function renderCal(){document.getElementById('calMonthLabel').textContent=MONTHS[cM]+' '+cY;const grid=document.getElementById('calGrid');grid.innerHTML='';const first=new Date(cY,cM,1).getDay(),days=new Date(cY,cM+1,0).getDate(),tStr=toStr(today);for(let i=0;i<first;i++){const e=document.createElement('div');e.className='cal-cell empty';grid.appendChild(e);}for(let d=1;d<=days;d++){const ds=toStr(new Date(cY,cM,d));const el=document.createElement('div');el.textContent=d;const isPast=ds<tStr,isToday=ds===tStr,slots=getSlotsForDate(ds),isOff=slots[0]==='OFF';if(isPast&&!isToday){el.className='cal-cell past';}else if(isOff){el.className='cal-cell off';}else{el.className='cal-cell open';el.onclick=()=>showSlots(ds,slots,el);}if(isToday)el.classList.add('today');grid.appendChild(el);}}
function showSlots(ds,slots,el){if(selCell)selCell.classList.remove('selected');selCell=el;el.classList.add('selected');const dow=new Date(ds+'T12:00:00').getDay();document.getElementById('slotsDateLbl').textContent=formatDate(ds);document.getElementById('slotsDayLbl').textContent=DAYS[dow];const body=document.getElementById('slotsBody');body.innerHTML='';slots.forEach(s=>{const r=document.createElement('div');r.className='slot-row';r.innerHTML='\u23F0 '+s;body.appendChild(r);});document.getElementById('tapHint').style.display='none';document.getElementById('slotsBox').classList.add('active');}
function hideSlots(){document.getElementById('slotsBox').classList.remove('active');document.getElementById('tapHint').style.display='block';if(selCell){selCell.classList.remove('selected');selCell=null;}}
renderCal();
<\/script>
</body>
</html>`;

  const blob = new Blob([html], {type:'text/html'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href=url; a.download='availability-calendar.html'; a.click();
  URL.revokeObjectURL(url);
}

// ── Init ──
refresh();
</script>
</body>
</html>
